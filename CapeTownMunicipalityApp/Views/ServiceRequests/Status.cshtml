@model CapeTownMunicipalityApp.Models.Report
@using CapeTownMunicipalityApp.Models
@{
    ViewData["Title"] = "Request Status";
    var percent = (double)(ViewBag.ProgressPercent ?? 0d);
    var path = (IEnumerable<ReportStatus>)(ViewBag.ProgressPath ?? Array.Empty<ReportStatus>());
}

<div class="container mt-4">
    <h2>Request Status</h2>

    <div class="card mb-3">
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <div><strong>Tracking Code:</strong> @Model.TrackingCode</div>
                    <div><strong>Category:</strong> @Model.Category</div>
                    <div><strong>Location:</strong> @Model.Location</div>
                </div>
                <div class="col-md-6">
                    <div><strong>Current Status:</strong> @Model.Status</div>
                    <div><strong>Priority:</strong> @Model.Priority</div>
                    <div><strong>Created:</strong> @Model.CreatedAt.ToLocalTime().ToString("g")</div>
                </div>
            </div>
        </div>
    </div>

    <div class="mb-3">
        <label class="form-label">Progress</label>
        <div class="progress" style="height: 24px;">
            <div class="progress-bar" role="progressbar" style="width:@percent%">
                @($"{percent:0}%")
            </div>
        </div>
        <div class="mt-2 text-muted">
            @string.Join(" â†’ ", path)
        </div>
    </div>

    <div class="card">
        <div class="card-header">Attachments</div>
        <ul class="list-group list-group-flush">
            @if (Model.Attatchments != null && Model.Attatchments.Count > 0)
            {
                foreach (var a in Model.Attatchments)
                {
                    <li class="list-group-item">
                        <a href="~/@a.FilePath" download>@a.FileName</a>
                    </li>
                }
            }
            else
            {
                <li class="list-group-item text-muted">No attachments</li>
            }
        </ul>
    </div>

    <div class="mt-3">
        <a asp-controller="ServiceRequests" asp-action="Index" class="btn btn-secondary">Back to List</a>
    </div>
</div>


